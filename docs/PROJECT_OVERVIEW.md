# vnpy-fubon 撠?璁汗

## 撠??桃?

vnpy-fubon 撠???銝蝯???Python 璅∠?嚗??拙?撖霅 Next Generation API ??vn.py 鈭斗?獢?游??敹璅?潘?

- 蝯曹?頛撖Ⅳ??霅身摰???霅?亥?靘??瘜?
- 撠?Fubon SDK ??????? vn.py ?Ｘ?????瑽?
- ???撠???Gateway 撖虫?嚗?撣單???柴?????質◤ vn.py 鈭辣撘?雿輻??
- ???臬??詨??葫閰血極?瘀?隞仿?撠?撖衣憓?霅?API 銵銝衣?箸葫閰血極隞嗚?

## ?詨??嗆?????蝔?

### 蝯???交?蝔?

1. `vnpy_fubon.config.load_configuration` 敺?`config/fubon_credentials.toml`?.env` ?憓??貉??蝙?刻?ID??霅楝敺?鞈?嚗蒂頛詨 `FubonCredentials` ??`SdkConfig`??
2. `vnpy_fubon.fubon_connect.FubonAPIConnector` 靘?`SdkConfig.client_class` ??頛 SDK 憿?遣蝡祕靘?銝血?閰虫誑銝?????澆 `login` 蝑?寞???
3. ??敺??喋歇撽???SDK client?????餃??嚗?蝥芋蝯?隞交迨 client ?箏蝷?

### Gateway ?芋蝯?隤?

- `vnpy_fubon.gateway.FubonGateway` 撠?`AccountAPI`?OrderAPI`?MarketAPI` 蝬??喳?銝??SDK client嚗蒂?? `connect/stop`?????晞董???其??亥岷???柴?桃?隞??
- Gateway ?批遣??瑁?蝺?鞎痊撠???隤輯???vn.py 鈭辣?摮?折雿?嚗蒂?舀釣?亥閮?鞎餉?靘? vn.py EventEngine嚗?
- `logging_config.configure_logging` ??Gateway ??Connector 閮剖?蝯曹???stdout/瑼?頛芣撘????箝?

### ?璅∠?

- `AccountAPI`嚗圾?董?嗉??其??賊???嚗?? `AccountData`?PositionData`??游?蝔?SDK ?寞??迂嚗query_account`?QueryAccount` 蝑???
- `OrderAPI`嚗?鋆??柴?柴閰Ｗ?閮??漱嚗蒂?拍 `mappings.py` 頧??孵???乓??誨蝣潦?
- `MarketAPI`嚗??????晞?瘨蝑?閰Ｚ??矽閮餃?嚗?鞈?頧 `TickData`??
- `vnpy_fubon.vnpy_compat`嚗?芸?鋆?vn.py ??靘??隞???伐?蝣箔??/皜祈岫?啣??舀迤撣詨銵?
- `exceptions.py`嚗?蝢抵身摰隤扎?亙仃??亙仃??撠靘???

## ??蝣潸??桅?蝯?

| 頝臬? | 閫隤芣? |
| --- | --- |
| `vnpy_fubon/` | 銝餃?隞塚??銝膩 config?onnector?ateway?ccount/order/market API?n.py ?詨捆撅方???撌亙??|
| `fubon_connect.py` | 撠????亙暺??湔?臬 `create_authenticated_client` ??CLI `main`??|
| `config/` | 蝭?蝯? (`fubon_credentials.example.toml`, `api_test_cases.example.toml`)嚗蝙?刻銴ˊ銝血‵?亦?撖血??詻?|
| `docs/` | ?蝑?????(`API_Analysis.md` 蝑?嚗瑼??粹?撅斗?閬賬?|
| `tests/` | Pytest 皜祈岫???拙極?瘀?撠????祕 API ?脰?甇??/鞎?獢?撽???|
| `artifacts/` | 皜祈岫?瑁???? JSON/JSONL 撌乩辣嚗???瘙???蝝啁???|
| `.env` | ?舫?憓??訾?皞?靘?`load_configuration` 頛??|

## Gateway ??圈?暺?

- Gateway ?曉蝜潭 vn.py `BaseGateway`嚗?隞嗆?隞?`EVENT_TICK`?EVENT_ORDER`?EVENT_TRADE` 敶Ｗ?瘜典 vn.py `EventEngine`??
- Gateway ??餃??敺???`exchange_realtime_token()` ??`init_realtime()`嚗蒂撠?亙??喟?蝚砌??董???亦Ⅳ?喲?蝯?`OrderAPI`??
- `MarketAPI` 撠釣?澆??詹?`TickData` ???? websocket 閮閫??嚗祕??????梁????Gateway 蝞∠???
- Gateway 鈭辣瘣暸 websocket/憪???湔頧? vn.py 璅?鈭辣嚗close()` ????websocket 鞈?銝行??方??晞?
- `FubonGateway.stop()` 蝬剜???`close()` ???靘踵???詨捆??
- 連線完成後自動透過 REST `intraday.products`/`intraday.tickers` 載入契約清單並發佈 `EVENT_CONTRACT`，供 vn.py 模組使用。
- Websocket ?乩葉?瑟??∠???輯????蒂?憟?Ｘ?閮??
- 摰??澆 `exchange_realtime_token()` 蝬剛風 session嚗?? `FUBON_TOKEN_REFRESH_INTERVAL` 閬神嚗?閮?15 ??嚗?
- ?舀 `switch_account()` ??`connect(setting={"account_id": ...})` ???餃撣唾???

## 皜祈岫??霅?蝔?

- `tests/test_api_functions.py` ?? `config/api_test_cases.toml` 頛皜祈岫獢?嚗?湔迤??鞎????葡瘚?霅??芸??極隞嗉撓?箝?
- `tests/conftest.py` ??撱箇? SDK ????遣瑽?銵?銝????葡瘚?隤?(`StreamingRecorder`) ??fixture??芸???`FUBON_ENABLE_LIVE_TESTS` ?撩撠?霅?嚗葫閰行??芸?頝喲???
- 皜祈岫?身?????喳祕??憓??踹???CI 銝炊頝???孵???`pytest --enable-live-tests` ?身摰憓???`FUBON_ENABLE_LIVE_TESTS=1`??
- `test_market_websocket_trades` 撽? websocket 閮瘚?嚗 Fubon 撣鞈?蝡舀銝?冽?璅???skipped??

## ?辣???潭?撘?

- `README.md` ????啣?撱箇???鞈游?鋆??smoke test ??牧??
- `docs/API_Analysis.md`?docs/API??.md`嚗?憪葉??閮??餈質馱 SDK 銵???撘?敺?蝛嗡???
- 撱箄降?冽?霅?蝣潸?皜祈岫獢?瑼?銝凋?????閮?祆?嚗?獢歇??`.gitignore` 敹賜撖阡?瑼?嚗?

## ?詨?雿輻??

1. 靘?README 撱箇???啣?銝血?鋆?鞈渲?摰 SDK??
2. 銴ˊ蝭? TOML嚗‵?亙??霅??單葫閰衣? API ???
3. ?澆 `vnpy_fubon.fubon_connect.create_authenticated_client()` ??撌脩?亦? SDK client嚗??? `FubonGateway` 霈?vn.py ?湔雿輻撣單/銝/銵????
4. ?仿?閬?霅?API 銵嚗???live tests嚗炎閬?`artifacts/api_tests/` ?Ｗ銋?獢誑瘥?????

甇支?璁汗?臭??粹霈蝔?蝣潭??游?璅∠???敹恍?閬質?閮剛??窗??
